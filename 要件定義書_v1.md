# 要件定義書（最終版）

## 1. システム概要

ユーザーがマークダウン形式で作成したスライド情報（タイトル・本文）をもとに、  
事前に用意したPowerPointスライドテンプレート群（構成情報はJSONで管理）から最適なテンプレートを自動選択し、各テンプレートの構成（オブジェクト・テキストエリア等）に合わせて内容を自動で割り当て、最終的にPowerPointファイルとして出力する自律型資料作成システム。

---

## 2. 処理の流れ

- **入力**：マークダウン形式で作成したスライド情報
  1. **マークダウン入力受付**
     - ユーザーはmarp形式に準拠したマークダウンでスライドを記述。
     - `---` 区切りでスライドを分割。

- **処理1**：エージェントが内容を踏まえ、流れを整理し、決められた形式に整形（エージェントで実行）
  - 上記の形式になっていない場合は、エージェントで自動的に整形。

- **処理2**：各ページごとにテンプレートを選択（エージェントで実行）
  - **テンプレート選択AI**
    - 各スライド内容に最適なテンプレートを自動判定・選択。
      - **テンプレート参照ツール**
        - 生成AIがテンプレート一覧や各テンプレートの構成情報を参照できる仕組み。
        - 全てのtemplate.jsonの内容を参照し、必要な情報を全て返す仕組み

- **処理3**：各ページごとにテンプレートに対応するように内容を構造化（エージェントで実行）
  - **内容割り当てAI**
    - テンプレートの各オブジェクト・テキストエリアに、ユーザー入力内容を分解・再構成して自動割り当て。
    - **オブジェクト情報取得ツール**
      - テンプレート名から、必要なオブジェクトやテキストエリア情報を取得できる仕組み。
      - 選択したtemplate.jsonの内容を参照し、必要な情報を全て返す仕組み

- **処理4**：各ページごとにテンプレートに内容を転写（pythonコードで自動的に実行）
  - **PowerPointファイル生成**
    - 割り当て結果をもとに、テンプレートに内容を転写し、PowerPointファイル（.pptx）として出力。
    - 既にあるpptxのテンプレートに対し、各要素にテキストを埋めていく形。
    - どのようにpptxの要素とjsonの要素を結びつけるかは、アイディア出して。
    - **レイアウト・デザイン一括調整**
      - フォント、強調色、行間、スペースなどの一律調整機能（最終微調整用）。
    - 今回生成したpptxスライドは全て統合して完成させる
    - **出力ファイルの保存・ダウンロード**
      - Webアプリの場合はダウンロード機能、CLIの場合はローカル保存。

- **出力**：PowerPointファイル
- 中間の生成ファイルは消さないように、中間ファイルとして残しておいて。エージェントの考えたスライドの構成など全て。全て.log or .txtなどで残して良い。

---

## 3. スライド管理

**テンプレート管理**
- テンプレートの構成情報（テンプレート名、説明、利用ケース例、オブジェクト種別、各エリアの名前や役割）はJSONで管理。
- テンプレートは随時追加可能（ユーザーがJSONを編集）。
- `templates/<各スライドのテンプレート名>/template.json`, `template.py`, `template.pptx` という形でスライド1枚のテンプレートをフォルダで管理する。
  - `template.json`：スライドの構成（全要素）が構造的に定義されている
  - `template.py`：`template.pptx`（実際のpptxテンプレート。これをコピーしたものに転写する）

---

## 4. システム構成（案）

- pythonコードで実行できるLangGraphベースの自律型AIエージェント(workflow形式で実装)
- テンプレート管理DB（JSONファイル群）
- PowerPoint生成モジュール（python-pptx等）

### 今回は実装対象外
- フロントエンド：streamlitでUI
- バックエンド：LangGraphベースの自律型AIエージェント

---

## 5. 技術要件

- LangGraph：最新バージョン
- AIモデル：OpenAIの最新モデル
- PowerPoint生成：python-pptx等
- テンプレート管理：JSON形式

---

## 6. テンプレートJSONサンプル

```json
[
  {
    "template_name": "タイトルスライド",
    "description": "プレゼンテーションの冒頭に使うタイトル用スライド",
    "use_case_examples": [
      "このテンプレートは、プレゼンテーションの冒頭でタイトル、発表者名、日付などを明確に示したい場合に使用します。例えば、学会発表や社内報告会などで、聴衆に発表の概要を最初に伝える際に最適です。"
    ],
    "objects": [
      {
        "type": "text",
        "name": "title",
        "role": "スライドの主タイトル"
      },
      {
        "type": "text",
        "name": "subtitle",
        "role": "サブタイトルや発表者名"
      },
      {
        "type": "text",
        "name": "date",
        "role": "日程"
      },
      {
        "type": "text",
        "name": "presenter",
        "role": "発表者"
      }
    ]
  },
  {
    "template_name": "1カラムテキスト",
    "description": "本文を1カラムで表示する標準的なスライド",
    "use_case_examples": [
      "このテンプレートは、製品やサービスの特徴を詳しく説明したい場合や、特定のトピックについて詳細な解説を行う際に利用します。例えば、社内研修で新しい業務フローを説明するスライドや、研究発表で理論の背景や詳細なデータを解説する場面に適しています。"
    ],
    "objects": [
      {
        "type": "text",
        "name": "title",
        "role": "タイトル"
      },
      {
        "type": "text",
        "name": "main_text",
        "role": "本文"
      }
    ]
  },
  {
    "template_name": "リード文+1カラムテキスト",
    "description": "リード文と本文を分けて表示するスライド",
    "use_case_examples": [
      "このテンプレートは、スライドの冒頭で要点（リード文）を簡潔に示し、その下で詳細な説明を加えたい場合に利用します。例えば、新しいプロジェクトの概要を一文で提示し、その後に背景や目的、具体的な内容を詳しく説明する場面に最適です。"
    ],
    "objects": [
      {
        "type": "text",
        "name": "title",
        "role": "タイトル"
      },
      {
        "type": "text",
        "name": "lead",
        "role": "リード文（要点）"
      },
      {
        "type": "text",
        "name": "main_text",
        "role": "本文"
      }
    ]
  },
  {
    "template_name": "2カラム（画像＋テキスト）",
    "description": "左に画像、右にテキストを配置するスライド",
    "use_case_examples": [
      "このテンプレートは、製品の構造や仕組みを図解で示し、その右側で詳細な説明を加えたい場合に適しています。例えば、新サービスの全体像をイメージ図で示し、隣に特徴やメリットを文章で解説する場面や、イベントの写真を掲載し、その内容や背景を右側で説明する際に活用できます。"
    ],
    "objects": [
      {
        "type": "text",
        "name": "title",
        "role": "タイトル"
      },
      {
        "type": "text",
        "name": "lead",
        "role": "リード文（要点）"
      },
      {
        "type": "image",
        "name": "left_image",
        "role": "左側の画像"
      },
      {
        "type": "text",
        "name": "right_text",
        "role": "右側のテキスト"
      }
    ]
  },
  {
    "template_name": "エンドスライド",
    "description": "発表の最後に使う締めのスライド",
    "use_case_examples": ["まとめ", "ご清聴ありがとうございました"],
    "objects": [
      {
        "type": "text",
        "name": "end_message",
        "role": "締めのメッセージ"
      }
    ]
  }
]
```

---

## 7. 出力ファイルの保存・ダウンロード

- CLI：ローカルにPowerPointファイルを保存
- Webアプリ：ユーザーがPowerPointファイルをダウンロード可能
